<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>3D Viewer with Buttons</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      /* 只在手機顯示控制按鈕 */
      .control-btn {
        position: fixed;
        width: 50px;
        height: 50px;
        background: rgba(0,0,0,0.5);
        color: white;
        font-size: 20px;
        border: none;
        border-radius: 5px;
        z-index: 999;
        display: none; /* 預設隱藏 */
      }
      #btnW { bottom: 110px; left: 20px; }
      #btnS { bottom: 20px; left: 20px; }
      #btnA { bottom: 65px; left: -10px; }
      #btnD { bottom: 65px; left: 50px; }

      #rotateBtn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: rgba(0,0,0,0.5);
        color: white;
        font-size: 24px;
        border: none;
        z-index: 999;
        display: none; /* 預設隱藏 */
      }
    </style>
  </head>
  <body>
    <!-- 左下移動按鈕 -->
    <button class="control-btn" id="btnW">W</button>
    <button class="control-btn" id="btnS">S</button>
    <button class="control-btn" id="btnA">A</button>
    <button class="control-btn" id="btnD">D</button>

    <!-- 右下旋轉按鈕 -->
    <button id="rotateBtn">⟳</button>

    <a-scene>
      <a-entity id="camera" camera look-controls position="0 1.6 3"></a-entity>

      <!-- GLB 模型 -->
      <a-assets>
        <a-asset-item id="livingroom" src="https://raw.githubusercontent.com/brad1845/Demo/main/living_room_indoor.glb"></a-asset-item>
      </a-assets>
      <a-entity gltf-model="#livingroom" position="0 0 -3" scale="1 1 1"></a-entity>

      <!-- 光源 -->
      <a-light type="ambient" color="#ffffff"></a-light>
      <a-light type="point" intensity="2" position="2 4 4"></a-light>

      <a-sky color="#ECECEC"></a-sky>
    </a-scene>

    <script>
      const camera = document.getElementById('camera');
      const speed = 0.2;
      const rotateSpeed = 5;

      // 判斷是否為手機
      const isMobile = /Mobi|Android/i.test(navigator.userAgent);
      if (isMobile) {
        document.querySelectorAll('.control-btn').forEach(btn => btn.style.display = 'block');
        document.getElementById('rotateBtn').style.display = 'block';
      }

      // 沿相機方向移動
      function moveForward(distance) {
        const rot = camera.getAttribute('rotation').y * (Math.PI/180);
        const dx = -Math.sin(rot) * distance;
        const dz = -Math.cos(rot) * distance;
        const pos = camera.getAttribute('position');
        camera.setAttribute('position', {
          x: pos.x + dx,
          y: pos.y,
          z: pos.z + dz
        });
      }

      function moveRight(distance) {
        const rot = camera.getAttribute('rotation').y * (Math.PI/180);
        const dx = Math.cos(rot) * distance;
        const dz = -Math.sin(rot) * distance;
        const pos = camera.getAttribute('position');
        camera.setAttribute('position', {
          x: pos.x + dx,
          y: pos.y,
          z: pos.z + dz
        });
      }

      function rotateCamera(angle) {
        const rot = camera.getAttribute('rotation');
        camera.setAttribute('rotation', {
          x: rot.x,
          y: rot.y + angle,
          z: rot.z
        });
      }

      // 手機按鈕事件
      if (isMobile) {
        document.getElementById('btnW').addEventListener('click', () => moveForward(speed));
        document.getElementById('btnS').addEventListener('click', () => moveForward(-speed));
        document.getElementById('btnA').addEventListener('click', () => moveRight(-speed));
        document.getElementById('btnD').addEventListener('click', () => moveRight(speed));

        let rotateInterval;
        const rotateBtn = document.getElementById('rotateBtn');

        rotateBtn.addEventListener('mousedown', () => {
          rotateInterval = setInterval(() => rotateCamera(rotateSpeed), 50);
        });
        rotateBtn.addEventListener('mouseup', () => clearInterval(rotateInterval));
        rotateBtn.addEventListener('mouseleave', () => clearInterval(rotateInterval));
        rotateBtn.addEventListener('touchstart', () => {
          rotateInterval = setInterval(() => rotateCamera(rotateSpeed), 50);
        });
        rotateBtn.addEventListener('touchend', () => clearInterval(rotateInterval));
      }

      // 鍵盤 WSAD
      document.addEventListener('keydown', (e) => {
        switch(e.key.toLowerCase()) {
          case 'w': moveForward(speed); break;
          case 's': moveForward(-speed); break;
          case 'a': moveRight(-speed); break;
          case 'd': moveRight(speed); break;
        }
      });
    </script>
  </body>
</html>
