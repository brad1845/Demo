<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>3D Viewer - Mobile Safe</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>
      /* 左下移動按鈕 */
      .control-btn {
        position: fixed;
        width: 50px;
        height: 50px;
        background: rgba(0,0,0,0.5);
        color: white;
        font-size: 20px;
        border: none;
        border-radius: 5px;
        z-index: 999;
      }
      #btnW { bottom: 110px; left: 20px; }
      #btnS { bottom: 20px; left: 20px; }
      #btnA { bottom: 65px; left: -10px; }
      #btnD { bottom: 65px; left: 50px; }

      /* 右下旋轉圓形按鈕 */
      #rotateBtn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: rgba(0,0,0,0.5);
        color: white;
        font-size: 24px;
        border: none;
        z-index: 999;
      }

      /* 手動進入 VR 按鈕 */
      #enterVR {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 10px 15px;
        background: rgba(0,0,0,0.5);
        color: white;
        border: none;
        border-radius: 5px;
        z-index: 999;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <!-- 左下移動按鈕 -->
    <button class="control-btn" id="btnW">W</button>
    <button class="control-btn" id="btnS">S</button>
    <button class="control-btn" id="btnA">A</button>
    <button class="control-btn" id="btnD">D</button>

    <!-- 右下旋轉按鈕 -->
    <button id="rotateBtn">⟳</button>

    <!-- 右上手動 VR -->
    <button id="enterVR">進入 VR</button>

    <a-scene vr-mode-ui="enabled: false">
      <!-- 相機，禁止 Magic Window 陀螺儀 -->
      <a-entity id="camera" camera look-controls="magicWindowTrackingEnabled: false" position="0 1.6 3"></a-entity>

      <!-- GLB 模型 -->
      <a-assets>
        <a-asset-item id="livingroom" src="https://raw.githubusercontent.com/brad1845/Demo/main/living_room_indoor.glb"></a-asset-item>
      </a-assets>
      <a-entity gltf-model="#livingroom" position="0 0 -3" scale="1 1 1"></a-entity>

      <!-- 光源 -->
      <a-light type="ambient" color="#ffffff"></a-light>
      <a-light type="point" intensity="2" position="2 4 4"></a-light>

      <!-- 天空 -->
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>

    <script>
      const camera = document.getElementById('camera');
      const speed = 0.2;       // 移動距離
      const rotateSpeed = 5;    // 旋轉角度

      // 移動函數
      function moveCamera(dx, dz) {
        const pos = camera.getAttribute('position');
        camera.setAttribute('position', {
          x: pos.x + dx,
          y: pos.y,
          z: pos.z + dz
        });
      }

      // 旋轉函數
      function rotateCamera(angle) {
        const rot = camera.getAttribute('rotation');
        camera.setAttribute('rotation', {
          x: rot.x,
          y: rot.y + angle,
          z: rot.z
        });
      }

      // 綁定移動按鈕
      document.getElementById('btnW').addEventListener('click', () => moveCamera(0, -speed));
      document.getElementById('btnS').addEventListener('click', () => moveCamera(0, speed));
      document.getElementById('btnA').addEventListener('click', () => moveCamera(-speed, 0));
      document.getElementById('btnD').addEventListener('click', () => moveCamera(speed, 0));

      // 旋轉按鈕長按
      let rotateInterval;
      const rotateBtn = document.getElementById('rotateBtn');
      rotateBtn.addEventListener('mousedown', () => {
        rotateInterval = setInterval(() => rotateCamera(rotateSpeed), 50);
      });
      rotateBtn.addEventListener('mouseup', () => clearInterval(rotateInterval));
      rotateBtn.addEventListener('mouseleave', () => clearInterval(rotateInterval));

      // 手機觸控長按
      rotateBtn.addEventListener('touchstart', () => {
        rotateInterval = setInterval(() => rotateCamera(rotateSpeed), 50);
      });
      rotateBtn.addEventListener('touchend', () => clearInterval(rotateInterval));

      // 手動進入 VR 按鈕
      document.getElementById('enterVR').addEventListener('click', () => {
        document.querySelector('a-scene').enterVR();
      });
    </script>
  </body>
</html>
